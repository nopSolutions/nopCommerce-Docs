---
title: কিভাবে আমার নিজের পেমেন্ট মেথড কোড করব
uid: bn/developer/plugins/payment-method
author: git.AndreiMaz
contributors: git.AfiaKhanom
---

# কিভাবে আমার নিজের পেমেন্ট মেথড কোড করব

পেমেন্ট মেথডগুলি নপকমার্স এ প্লাগইন হিসাবে প্রয়োগ করা হয়। নতুন পেমেন্ট মেথড কোডিং শুরু করার আগে [নপকমার্স ৪.৪০ এর জন্য একটি প্লাগইন কিভাবে লিখবেন](xref:bn/developer/plugins/how-to-write-plugin-4.40) পড়ার পরামর্শ দিচ্ছি। প্লাগইন তৈরির জন্য প্রয়োজনীয় পদক্ষেপগুলি আপনাকে ব্যাখ্যা করবে।

তাই আসলে একটি পেমেন্ট মেথড হল একটি সাধারণ প্লাগইন যা একটি IPaymentMethod ইন্টারফেস প্রয়োগ করে (Nop.Services.Payments namespace)। যেমন আপনি ইতিমধ্যেই অনুমান করেছেন IPaymentMethod ইন্টারফেস পেমেন্ট মেথড প্লাগইন তৈরির জন্য ব্যবহৃত হয়। এতে কিছু মেথড রয়েছে যা শুধুমাত্র পেমেন্ট মেথডের জন্য নির্দিষ্ট যেমন ProcessPayment() বা GetAdditionalHandlingFee()। সুতরাং সমাধানের জন্য একটি নতুন পেমেন্ট প্লাগইন প্রকল্প (class library) যোগ করুন এবং শুরু করা যাক।

## কন্ট্রোলার, ভিউ, মডেল

প্রথমে আপনাকে যা করতে হবে তা হল একটি কন্ট্রোলার তৈরি করা। ASP.NET MVC ওয়েবসাইটের বিরুদ্ধে করা অনুরোধের সাড়া দেওয়ার জন্য এই কন্ট্রোলার দায়ী।

১. একটি নতুন পেমেন্ট মেথড প্রয়োগ করার সময়, এই কন্ট্রোলারটি একটি বিশেষ **BasePaymentController** আবসট্রাকট ক্লাস থেকে নেওয়া উচিত।

২. তারপর বাস্তবায়ন করুন **কনফিগার** প্লাগইন কনফিগারেশনের জন্য ব্যবহৃত অ্যাকশন মেথড (অ্যাডমিন এলাকায় একটি দোকান মালিকের দ্বারা)। এই মেথড এবং একটি উপযুক্ত ভিউ নির্ধারণ করবে কিভাবে একজন দোকান মালিক অ্যাডমিন প্যানেলে কনফিগারেশন অপশন দেখে (System → Configuration → Payment methods)।

## পাবলিক ভিউ component.GetPublicViewComponent

তারপর আপনাকে পাবলিক স্টোরে প্লাগইন প্রদর্শনের জন্য একটি ভিউ কম্পোনেন্ট তৈরি করতে হবে। এই ভিউ কম্পোনেন্ট এবং একটি উপযুক্ত ভিউ চেকআউটের সময় আপনার গ্রাহকরা কিভাবে পেমেন্ট তথ্য পৃষ্ঠা দেখতে পাবেন তা নির্ধারণ করবে। প্রথমে একটি ভিউ কম্পোনেন্ট ক্লাস তৈরি করা যাক। এটি /Components ফোল্ডারে স্থাপন করা উচিত। PayPalStandard প্লাগইন এর জন্য এটি কীভাবে করা হয়েছে তা দেখুন:

```csharp
[ViewComponent(Name = "PaymentPayPalStandard")]
public class PaymentPayPalStandardViewComponent : NopViewComponent
{
    public IViewComponentResult Invoke()
    {
        return View("~/Plugins/Payments.PayPalStandard/Views/PaymentInfo.cshtml");
    }
}
```

ইনভোক মেথড আপনার প্লাগইন এর */Views* ফোল্ডার থেকে একটি উপযুক্ত পেমেন্ট ইনফো ভিউ প্রদান করে। মনে রাখবেন যে আমরা বিদ্যমান বিল্ট-ইন ভিউ কম্পোনেন্টের পরিবর্তে আমাদের কাস্টম NopViewComponent ক্লাসকে বেস ক্লাস হিসাবে ব্যবহার করি।

তাহলে আসুন PaymentInfo ভিউ তৈরি করি যা পেমেন্ট তথ্য দেখায়। PayPalStandard প্লাগইনটির জন্য এই ভিউটি বেশ সহজ। সেখানে আমরা শুধু পাঠ্যটি রেন্ডার করে বলছি যে একজন গ্রাহককে পেমেন্ট পৃষ্ঠায় পুননির্দেশিত করা হবে। কিন্তু প্রয়োজন হলে আরো জটিল ভিউ কম্পোনেন্ট তৈরি করা সম্ভব। উদাহরণস্বরূপ যদি আপনি পেমেন্ট তথ্য পৃষ্ঠায় গ্রাহকের তথ্য সংগ্রহ করতে চান তাহলে দেখুন PayPalDirect পেমেন্ট প্লাগইন এ এটি ইতিমধ্যেই কিভাবে সম্পন্ন হয়েছে।

## পেমেন্ট প্রসেসিং

এখন আপনাকে একটি ক্লাস তৈরি করতে হবে যা **IPaymentMethod** ইন্টারফেস প্রয়োগ করে। এই ক্লাসটিই আপনার পেমেন্ট গেটওয়ের সাথে যোগাযোগের সমস্ত প্রকৃত কাজ করবে। যখন কেউ অর্ডার তৈরি করে তখন হয় আপনার প্রসেসের **ProcessPayment** অথবা **PostProcessPayment** মেথড বলা হবে। এখানে কিভাবে CheckMoneyOrderPaymentProcessor ক্লাস সংজ্ঞায়িত করা হয়েছে ("CheckMoneyOrder" পেমেন্ট মেথড):

```csharp
public class CheckMoneyOrderPaymentProcessor : BasePlugin, IPaymentMethod
```

- **IPaymentMethod** ইন্টারফেসের বেশ কয়েকটি মেথড এবং বৈশিষ্ট্য রয়েছে যা বাস্তবায়নের জন্য প্রয়োজন।

- **ValidatePaymentForm**. পাবলিক স্টোরে গ্রাহকের ইনপুট যাচাই করতে ব্যবহৃত হয়। এটি সতর্কতার একটি তালিকা প্রদান করে (উদাহরণস্বরূপ, একজন গ্রাহক তার ক্রেডিট কার্ডের নাম লিখেননি)। যদি আপনার পেমেন্ট মেথড গ্রাহককে অতিরিক্ত তথ্য দিতে না বলে, তাহলে ValidatePaymentForm একটি খালি তালিকা ফেরত দিবে:

```csharp
    public Task<IList<string>> ValidatePaymentFormAsync(IFormCollection form)
    {
        return Task.FromResult<IList<string>>(new List<string>());
    }
```

- **GetPaymentInfo**. মেথড পাবলিক স্টোরে ব্যবহার করা হয় গ্রাহকদের ইনপুট বিশ্লেষণ করতে, যেমন ক্রেডিট কার্ডের তথ্য। এই মেথডটি বিশ্লেষিত গ্রাহক ইনপুট সহ একটি ProcessPaymentRequest অবজেক্ট প্রদান করে (উদাহরণস্বরূপ, ক্রেডিট কার্ডের তথ্য)। যদি আপনার পেমেন্ট মেথড গ্রাহককে অতিরিক্ত তথ্য দিতে না বলে, তাহলে GetPaymentInfo একটি খালি ProcessPaymentRequest অবজেক্ট ফেরত দেবে:

```csharp
    public Task<ProcessPaymentRequest> GetPaymentInfoAsync(IFormCollection form)
    {
        return Task.FromResult(new ProcessPaymentRequest());
    }
```

- **ProcessPayment**. কোনও গ্রাহক অর্ডার দেওয়ার আগে এই মেথডটি সর্বদা প্রয়োগ করা হয়। অর্ডার ডাটাবেসে সংরক্ষণ করার আগে যখন আপনার পেমেন্ট প্রক্রিয়া করার প্রয়োজন হয় তখন এটি ব্যবহার করুন। উদাহরণস্বরূপ, ক্রেডিট কার্ড ক্যাপচার বা অনুমোদন করুন। সাধারণত এই মেথডটি ব্যবহার করা হয় যখন কোন গ্রাহককে পেমেন্ট সম্পন্ন করার জন্য তৃতীয় পক্ষের সাইটে পুননির্দেশিত করা হয় না এবং সমস্ত পেমেন্ট আপনার সাইটে পরিচালনা করা হয় (উদাহরণস্বরূপ, পেপ্যাল ​​ডাইরেক্ট)।
- **PostProcessPayment**. একজন গ্রাহক অর্ডার দেওয়ার পরেই এই মেথডটি চালু করা হয়। সাধারণত এই মেথডটি ব্যবহার করা হয় যখন আপনি একটি পেমেন্ট সম্পন্ন করার জন্য একটি গ্রাহককে তৃতীয় পক্ষের সাইটে পুননির্দেশিত করতে চান (উদাহরণস্বরূপ, পেপ্যাল ​​স্ট্যান্ডার্ড)।
- **HidePaymentMethod**. আপনি যেকোন যুক্তি এখানে রাখতে পারেন। উদাহরণস্বরূপ, কার্টের সমস্ত পণ্য ডাউনলোডযোগ্য হলে এই পেমেন্ট মেথডটি লুকান। অথবা বর্তমান গ্রাহক নির্দিষ্ট দেশ থেকে হলে এই পেমেন্ট মেথডটি লুকানো।
- **GetAdditionalHandlingFee**. আপনি যেকোন অতিরিক্ত হ্যান্ডলিং ফি ফেরত দিতে পারেন যা মোট অর্ডারে যোগ করা হবে।
- **Capture**. কিছু পেমেন্ট গেটওয়ে আপনাকে ক্যাপচার করার আগে পেমেন্ট অনুমোদন করতে দেয়। এটি দোকান মালিকদের পেমেন্ট করার আগে অর্ডারের বিস্তারিত পর্যালোচনা করতে দেয়। এই ক্ষেত্রে আপনি শুধু **ProcessPayment** বা **PostProcessPayment** মেথডতে (উপরে বর্ণিত) একটি পেমেন্ট অনুমোদন করেন, এবং তারপর শুধু এটি ক্যাপচার করুন। এই ক্ষেত্রে একটি **Capture** বাটন অ্যাডমিন এলাকায় অর্ডারের বিস্তারিত পৃষ্ঠায় দৃশ্যমান হবে। মনে রাখবেন যে একটি অর্ডার ইতিমধ্যে অনুমোদিত হওয়া উচিত এবং **SupportCapture** প্রোপার্টি **true** ফিরতে হবে।
- **Refund**. এই মেথডটি আপনাকে ফেরত দেওয়ার অনুমতি দেয়। এই ক্ষেত্রে অ্যাডমিন এলাকায় অর্ডারের বিস্তারিত পৃষ্ঠায় একটি **Refund** বাটন দৃশ্যমান হবে। মনে রাখবেন যে একটি অর্ডার দেওয়া উচিত, এবং **SupportRefund** অথবা **SupportPartiallyRefund** প্রোপার্টি অবশ্যই **true** ফিরতে হবে।
- **Void**. এই মেথডটি আপনাকে একটি অনুমোদিত কিন্তু ক্যাপচারকৃত পেমেন্ট বাতিল করতে দেয়। এই ক্ষেত্রে অ্যাডমিন এলাকায় অর্ডারের বিস্তারিত পৃষ্ঠায় একটি **Void** বাটন দৃশ্যমান হবে। লক্ষ্য করুন যে একটি আদেশ অনুমোদিত হওয়া উচিত এবং **SupportVoid** প্রোপার্টি **true** ফিরতে হবে।
- **ProcessRecurringPayment**. পুনরাবৃত্ত পেমেন্ট প্রক্রিয়া করার জন্য এই মেথডটি ব্যবহার করুন।
- **CancelRecurringPayment**. পুনরাবৃত্ত পেমেন্ট বাতিল করতে এই মেথড ব্যবহার করুন।
- **CanRePostProcessPayment**. সাধারণত এই মেথড ব্যবহার করা হয় যখন এটি একটি গ্রাহককে তৃতীয় পক্ষের সাইটে পেমেন্ট সম্পন্ন করার জন্য পুননির্দেশিত করে। যদি তৃতীয় পক্ষের পেমেন্ট ব্যর্থ হয় তবে এই বিকল্পটি গ্রাহকদের নতুন অর্ডার না দিয়ে পরে আবার অর্ডার করার চেষ্টা করবে। **CanRePostProcessPayment** এই বৈশিষ্ট্যটি সক্ষম করতে **true** ফিরতে হবে।
- **GetConfigurationPageUrl**. আপনার মনে আছে আমরা আগের ধাপে একটি নিয়ামক তৈরি করেছি। এই মেথডটি তার কনফিগার মেথডের একটি ইউআরএল ফেরত দেওয়া উচিত। উদাহরণ স্বরূপ:

```csharp
    public override string GetConfigurationPageUrl()
    {
        return $"{_webHelper.GetStoreLocation()}Admin/PaymentCheckMoneyOrder/Configure";
    }
```

- **GetPublicViewComponentName**। এই মেথডে ভিউ কম্পোনেন্টের নাম ফেরত দেওয়া উচিত যা গ্রাহকদের জন্য সর্বজনীন তথ্য প্রদর্শন করতে ব্যবহৃত হয়। আমরা আগের ধাপে একটি উপযুক্ত ভিউ কম্পোনেন্ট তৈরি করেছি। উদাহরণ স্বরূপ:

```csharp
    public string GetPublicViewComponentName()
    {
        viewComponentName = "CheckMoneyOrder";
    }
```

- **SupportCapture, SupportPartiallyRefund, SupportRefund, SupportVoid**. এই বৈশিষ্ট্যগুলি নির্দেশ করে যে আপনার পেমেন্ট মেথডের উপযুক্ত মেথড সমর্থিত কিনা।
- **RecurringPaymentType**. এই প্রপার্টি নির্দেশ করে যে পুনরাবৃত্ত অর্থ প্রদান সমর্থিত কিনা।
- **PaymentMethodType**. এই প্রপার্টি পেমেন্ট মেথডের ধরন নির্দেশ করে। বর্তমানে তিন প্রকার। **Standard** পেমেন্ট মেথড দ্বারা ব্যবহৃত হয় যখন কোন গ্রাহককে তৃতীয় পক্ষের সাইটে পুননির্দেশিত করা হয় না। **Redirection** ব্যবহার করা হয় যখন একজন গ্রাহককে তৃতীয় পক্ষের সাইটে পুননির্দেশিত করা হয়। এবং **Button** **Redirection** পেমেন্ট মেথডর অনুরূপ। শুধুমাত্র পার্থক্যটি ব্যবহার করা হয় যে এটি শপিং কার্ট পৃষ্ঠায় একটি বোতাম হিসাবে প্রদর্শিত হয় (উদাহরণস্বরূপ, গুগল চেকআউট)।
- **SkipPaymentInfo**. এই প্লাগইনটির জন্য আমাদের একটি পেমেন্ট তথ্য পৃষ্ঠা প্রদর্শন করা উচিত কিনা তা নির্দেশ করে।
- **PaymentMethodDescription**. এই প্রপার্টি একটি পেমেন্ট মেথডের বিবরণ পায় যা পাবলিক স্টোরের চেকআউট পৃষ্ঠায় প্রদর্শিত হবে।

## উপসংহার

আশা করি এটি আপনাকে একটি নতুন পেমেন্ট মেথড যুক্ত করে শুরু করবেন।
